{{- if .Values.ingress.enabled -}}
{{- $fullName := include "pangolin.fullname" . -}}
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: {{ $fullName }}-pangolin-http-ingress
spec:
  entryPoints:
    - web
  routes:
  - match: Host(`{{ .Values.ingress.hostDomain }}`) || HostRegexp(`^.+\.{{ .Values.ingress.hostDomain }}`)
    services:
      - name: {{ $fullName }}-gerbil-cip
        port: 80
---
apiVersion: traefik.io/v1alpha1
kind: IngressRouteTCP
metadata:
  name: {{ $fullName }}-pangolin-tcp-ingress
spec:
  entryPoints:
    - websecure
  routes:
  - match: HostSNI(`{{ .Values.ingress.hostDomain }}`) || HostSNIRegexp(`^.+\.{{ .Values.ingress.hostDomain  }}$`)
    services:
      - name: {{ $fullName }}-gerbil-cip
        port: 443
  tls:
    passthrough: true
# ---
# apiVersion: traefik.io/v1alpha1
# kind: IngressRouteTCP
# metadata:
#   name: {{ $fullName }}-pangolin-tcp-ingress-wc
# spec:
#   entryPoints:
#     - websecure
#   routes:
#   # - match: HostSNI(`jelly.{{ .Values.ingress.hostDomain }}`)
#   - match: HostSNIRegexp(`^.+\.{{ .Values.ingress.hostDomain  }}$`)
#     services:
#       - name: {{ $fullName }}-gerbil-cip
#         port: 443
#   tls:
#     passthrough: true
{{- end }}
